| задача                                                       | отметка о выполнении | комментарий                                                  |
| ------------------------------------------------------------ | -------------------- | ------------------------------------------------------------ |
| создайте  виртуальную машину c Ubuntu 20.04 LTS      (bionic) в GCE типа e2-medium в default VPC в любом регионе и зоне     , например us-central1-a | +                    | bionic 20.04 LTS нет в списке доступных                      |
| поставьте на нее PostgreSQL  через sudo apt                  | +                    |                                                              |
| поставьте  на нее PostgreSQL через sudo apt                  | +                    |                                                              |
| проверьте что кластер запущен  через sudo -u postgres pg_lsclusters | +                    |                                                              |
| зайдите  из под пользователя postgres в psql и сделайте произвольную      таблицу с произвольным содержимым postgres=# create table test(c1 text);  postgres=# insert into test values('1'); \q | +                    |                                                              |
| остановите postgres например  через sudo -u postgres pg_ctlcluster 14 main stop | +                    |                                                              |
| создайте  новый standard persistent диск GKE через Compute Engine ->      Disks в том же регионе и зоне что GCE инстанс размером например 10GB | +                    |                                                              |
| добавьте  свеже-созданный диск к виртуальной машине - надо зайти в режим ее      редактирования и дальше выбрать пункт attach existing disk | +                    |                                                              |
| проинициализируйте  диск согласно инструкции и подмонтировать файловую систему,      только не забывайте менять имя диска на актуальное, в вашем случае это  скорее всего      будет      /dev/sdb - https://www.digitalocean.com/community/tutorials/how-to-partition-and-format-storage-devices-in-linux | +                    |                                                              |
| сделайте пользователя postgres  владельцем /mnt/data - chown -R postgres:postgres /mnt/data/ | +                    |                                                              |
| перенесите содержимое  /var/lib/postgres/13 в /mnt/data - mv /var/lib/postgresql/13 /mnt/data | +                    |                                                              |
| попытайтесь запустить кластер  - sudo -u postgres pg_ctlcluster 13 main start | +                    |                                                              |
| напишите получилось или нет и  почему                        | +                    | несмотря на физический перенос файлов, в конфигах PG остались старые  пути. Нужно выправить конфиги на новый путь |
| задание:  найти конфигурационный параметр в файлах раположенных в  /etc/postgresql/10/main      который надо поменять и поменяйте его | +                    |                                                              |
| напишите что и почему поменяли                               | +                    | в файле postgres.conf поменял значение data_directory, т.к. мы физически  перенесли каталоги в /mnt/data, а конфиг ссылался на старый путь |
| попытайтесь запустить кластер  - sudo -u postgres pg_ctlcluster 13 main start | +                    |                                                              |
| напишите получилось или нет и  почему                        | +                    | получилось, т.к. конфиг ссылается на новый путь (в моём случае я ошибся с  командой копирования и в результате у меня путь запуска посгреса выглядит как  /mnt/data/14/main, решается перемещением main на уровень выше и  прописсыванием конфига) |
| зайдите через через psql и  проверьте содержимое ранее созданной таблицы | +                    | содержимое на месте                                          |
| задание  со звездочкой *: не удаляя существующий GCE инстанс сделайте новый, поставьте  на его PostgreSQL     , удалите файлы с данными из /var/lib/postgres, перемонтируйте внешний диск  который сделали ранее от первой      виртуальной машины ко второй и запустите PostgreSQL на второй машине так  чтобы он работал с данными      на внешнем диске, расскажите как вы это сделали и что в итоге получилось. | +                    | Получилось не с первого раза, скорее всего потому, что с первого раза не до конца понял как правильно отмонтировать диск. В результате пришлось создать postgres03-1, т.к. первоначально данные были судя по всему потеряны. В конечном итоге были произведены следующие действия:<br />1. отмонтировать диск через sudo umount /dev/sdb1<br />2. отключить накопитель от инстанса, делал через веб-интерфейс<br />3. подключил диск к инстансу, созданному под эту задачу postgres03star (забыл что звёздочка - это asterisk, потому такой топорный нейминг)<br />4. примонтировал через sudo mount -o defaults /dev/sdb1 /var/lib/postgresql/ таким образом дальнейший путь выстроился как нужно для старта: /var/lib/postgresql/14/main/...<br />5. стартанул PG и проверил что инстанс поднят. |

